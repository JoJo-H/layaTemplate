var Pan3d,__extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var s in i)i.hasOwnProperty(s)&&(t[s]=i[s])};return function(i,s){function e(){this.constructor=i}t(i,s),i.prototype=null===s?Object.create(s):(e.prototype=s.prototype,new e)}}();!function(t){var i=function(i){function o(){var t=null!==i&&i.apply(this,arguments)||this;return t.p_scrollY=0,t.p_scrollX=0,t._showItemNum=0,t._allItemNum=0,t._topSize=0,t._bottomSize=0,t._outSize=0,t._showDataIndex=0,t.scrollLock=!1,t._minScrollY=0,t._maskLevel=2,t._mouseY=0,t._dragFlag=!1,t._dragY=0,t._dragMaxY=100,t}return __extends(o,i),o.prototype.setData=function(i,o,n,r,a,_,l,d,c,f,p,u){if(void 0===u&&(u=0),this.width=n,this._height=r,this.p_itemHeight=_,this.p_itemWidth=a,this._showIndexList=new Array,this._dataAry=i,this._showItemNum=l,this._allItemNum=f*p,this._contentX=f,this._contentY=p,this._outSize=(p-this._showItemNum)*_,this._topSize=0,this._bottomSize=this._outSize,this._showDataIndex=0,this._sAtlas=new h,this._sAtlas.setData(d,c,f,p),this.bgMask=new t.UIMask,this.bgMask.x=0,this.bgMask.y=0,this.bgMask.width=n,this.bgMask.height=r,this.bgMask.level=this._maskLevel,this.addMask(this.bgMask),this._bgRender=new s,this._bgRender.uiAtlas=this._sAtlas,this._bgRender.slist=this,this.addRender(this._bgRender),this._baseRender=new e,this._baseRender.uiAtlas=this._sAtlas,this.addRender(this._baseRender),this._bgRender.mask=this.bgMask,this._baseRender.mask=this.bgMask,0!=u){this.customRenderAry=new Array;for(g=0;g<u;g++){var m=new e;m.uiAtlas=this._sAtlas,this.addRender(m),m.mask=this.bgMask,this.customRenderAry.push(m)}}this._itemList=new Array;for(var g=0;g<this._allItemNum;g++){var y=new o;y.baseY=float2int(g/f)*_,y.baseX=g%f*a,y.uiAtlas=this._sAtlas,y.index=g,y.parentTarget=this,y.create(this,this._bgRender,this._baseRender,this.customRenderAry),y.render(i[g]),this._itemList.push(y),this._showIndexList.push(g)}this._minScrollY=this._height-float2int(this._dataAry.length/this._contentX)*this.p_itemHeight,this.scrollY(0),Math.ceil(i.length/this._contentX)<=this._showItemNum?this.scrollLock=!0:this.scrollLock=!1,this.initComplte()},o.prototype.initComplte=function(){},o.prototype.setShowLevel=function(t){this._maskLevel=t,this.bgMask&&(this.bgMask.level=this._maskLevel)},o.prototype.setSelect=function(t){for(var i=0;i<this._itemList.length;i++)this._itemList[i]==t?(this._currentSelIdx=this._dataAry.indexOf(this._itemList[i].itdata),this._itemList[i].selected=!0):this._itemList[i].selected&&(this._itemList[i].selected=!1)},o.prototype.setSelectIndex=function(t){this._currentSelIdx=t;for(var i=0;i<this._itemList.length;i++)this._itemList[i].itdata&&this._itemList[i].itdata.id==t?this._itemList[i].selected=!0:this._itemList[i].selected&&(this._itemList[i].selected=!1)},o.prototype.getCurrentSelectIndex=function(){return this._currentSelIdx||(this._currentSelIdx=0),this._currentSelIdx},o.prototype.changeMinScrollY=function(){this._minScrollY=this._height-Math.ceil(this._dataAry.length/this._contentX)*this.p_itemHeight},o.prototype.refreshData=function(t){this._dataAry=t,this._showIndexList=new Array;for(var i=0;i<this._itemList.length;i++)this._itemList[i].render(t[i]),this._itemList[i].baseY=float2int(i/this._contentX)*this.p_itemHeight,this._showIndexList.push(i);this._outSize=(this._contentY-this._showItemNum)*this.p_itemHeight,this._topSize=0,this._bottomSize=this._outSize,this._showDataIndex=0,this._minScrollY=this._height-Math.ceil(this._dataAry.length/this._contentX)*this.p_itemHeight,this.scrollY(0),Math.ceil(t.length/this._contentX)<=this._showItemNum?this.scrollLock=!0:this.scrollLock=!1},o.prototype.setItemData=function(t,i){this._dataAry[i].data=t;for(var s=0;s<this._itemList.length;s++)if(this._itemList[s].itdata==this._dataAry[i]){this._itemList[s].refreshDraw();break}},o.prototype.clearItemByPos=function(t){this._dataAry[t].data=null;for(var i=0;i<this._itemList.length;i++)if(this._itemList[i].itdata==this._dataAry[t]){this._itemList[i].refreshDraw();break}},o.prototype.getDataSize=function(){return this._dataAry.length},o.prototype.refreshDraw=function(){for(var t=0;t<this._itemList.length;t++)this._itemList[t].refreshDraw()},o.prototype.scroll=function(){},o.prototype.interactiveEvent=function(i){return i.type==t.InteractiveEvent.Down?!!this.bgMask.testPoint(i.x,i.y)&&(this._mouseY=i.y,this.scrollLock&&!this._dragFlag||(t.Scene_data.uiStage.addEventListener(t.InteractiveEvent.Move,this.onMove,this),t.Scene_data.uiStage.addEventListener(t.InteractiveEvent.Up,this.onUp,this)),!0):i.type==t.InteractiveEvent.Up&&this.bgMask.testPoint(i.x,i.y)},o.prototype.onMove=function(t){var i=t.y-this._mouseY;this._mouseY=t.y,i<0&&this.scrollLock||this.scrollY(i)},o.prototype.onUp=function(i){var s=this;t.Scene_data.uiStage.removeEventListener(t.InteractiveEvent.Move,this.onMove,this),t.Scene_data.uiStage.removeEventListener(t.InteractiveEvent.Up,this.onUp,this),this._dragFlag&&(this._dragY<0?this._dragDownFun&&this._dragDownFun():this._dragY>0&&this._dragUpFun&&this._dragUpFun(),0!=this._dragY&&TweenMoveTo(this,.5,{dragY:0,onUpdate:function(){s.refreshResultPos()}}))},o.prototype.setDragFun=function(t,i){this._dragUpFun=t,this._dragDownFun=i,t||i?this._dragFlag=!0:(this._dragFlag=!1,this._dragY=0)},Object.defineProperty(o.prototype,"dragY",{get:function(){return this._dragY},set:function(t){this._dragY=t},enumerable:!0,configurable:!0}),o.prototype.scrollIdx=function(t){var i=-this.p_itemHeight*t-this.p_scrollY,s=Math.ceil(Math.abs(i)/this.p_itemHeight);i/=s;for(var e=0;e<s;e++)this.scrollY(i)},o.prototype.getIdxY=function(t){return this.p_itemHeight*t},o.prototype.getIdxX=function(t){return this.p_itemWidth*t},o.prototype.scrollY=function(t){if(this._topSize-=t,this._bottomSize+=t,this._topSize<=0)if(this._bottomflag=!0,0==this._showDataIndex)this._topSize=0,this._bottomSize=this._outSize,this.p_scrollY=0,this._topflag=!1,this._dragFlag&&Math.abs(this._dragY)<this._dragMaxY&&(this._dragY+=t);else{for(var i=this._showIndexList[0],s=this._itemList[i].baseY-this.p_itemHeight,e=0;e<this._contentX;e++){n=this._showIndexList.pop();this._showIndexList.unshift(n),this._itemList[n].baseY=s,this._itemList[n].render(this._dataAry[this._showDataIndex-1]),this._itemList[n].selected=this.getCurrentSelectIndex()==this._showDataIndex-1,this._showDataIndex--}this._bottomSize-=this.p_itemHeight,this._topSize+=this.p_itemHeight,this.p_scrollY+=t,this._topflag=!0}else if(this._bottomSize<=0)if(this._topflag=!0,this._showDataIndex+this._allItemNum>=this._dataAry.length)this._bottomSize=0,this._topSize=this._outSize,this.p_scrollY=-(Math.ceil(this._dataAry.length/this._contentX)-this._showItemNum)*this.p_itemHeight,this._bottomflag=!1;else{this._bottomflag=!0;for(var h=this._showIndexList[this._showIndexList.length-1],o=this._itemList[h].baseY+this.p_itemHeight,e=0;e<this._contentX;e++){var n=this._showIndexList.shift();this._showIndexList.push(n),this._itemList[n].baseY=o,this._itemList[n].render(this._dataAry[this._showDataIndex+this._allItemNum]),this._itemList[n].selected=this.getCurrentSelectIndex()==this._showDataIndex+this._allItemNum,this._showDataIndex++}this._bottomSize+=this.p_itemHeight,this._topSize-=this.p_itemHeight,this.p_scrollY+=t}else this._showItemNum>=this._dataAry.length?(this._topflag=!1,this._bottomflag=!1,this.p_scrollY=0):(this._topflag=!0,this._bottomflag=!0,this.p_scrollY+=t);this.p_scrollY<=this._minScrollY&&this._minScrollY<0&&(this.p_scrollY=this._minScrollY,this._topSize+=t,this._bottomSize-=t,this._topflag=!0,this._bottomflag=!1,this._dragFlag&&Math.abs(this._dragY)<this._dragMaxY&&(this._dragY+=t)),this.refreshResultPos(),this.backFun&&this.backFun(this._topflag,this._bottomflag,t)},o.prototype.refreshResultPos=function(){for(var t=0;t<this._itemList.length;t++)this._itemList[t].setY(this.p_scrollY+this._dragY)},o.prototype.dispose=function(){if(this._bgRender.dispose(),this._baseRender.dispose(),this.customRenderAry)for(var t=0;t<this.customRenderAry.length;t++)this.customRenderAry[t].dispose();this.bgMask.dispose()},o}(t.UIVirtualContainer);t.SList=i;!function(){function i(){this._height=10,this._list=new Array,this.index=0,this.baseY=0,this.baseX=0,this._selected=!1}i.prototype.addUI=function(t){this._list.push(t)},i.prototype.create=function(t,i,s,e){void 0===e&&(e=null),this._bgRender=i,this._baseRender=s,this._customRenderAry=e},i.prototype.render=function(t){},i.prototype.refreshDraw=function(){},i.prototype.setSelect=function(){this.parentTarget.setSelect(this)},i.prototype.unSetSelect=function(){this.selected=!1},Object.defineProperty(i.prototype,"selected",{get:function(){return this._selected},set:function(t){this._selected=t},enumerable:!0,configurable:!0}),i.prototype.creatSUI=function(t,i,s,e,h,o,n){var r=i.getLayoutData(s),a=s+this.index;this.uiAtlas.addConfig(a,this.index,r.rect);var _=t.creatBaseComponent(a),r=new Object;return _.name=s,_.x=r.x=e,_.y=r.y=h,_.width=r.width=o,_.height=r.height=n,_.baseRec=r,this._list.push(_),_},i.prototype.creatGrid9Component=function(i,s,e,h){var o=new t.Grid9Compenent,n=this.uiAtlas.getGridRec(s);return n.ogw=e,n.ogh=h,o.tr.setRec(n),o.ogw=n.ogw,o.ogh=n.ogh,o.gw=o.ogw/n.pixelWitdh,o.gh=o.ogh/n.pixelHeight,o.tr.setRec(n),o.skinName=s,o.uiRender=i,o},i.prototype.creatGrid9SUI=function(t,i,s,e,h,o,n,r,a){void 0===r&&(r=5),void 0===a&&(a=5);var _=i.getLayoutData(s),l=s+this.index;this.uiAtlas.addConfig(l,this.index,_.rect);var d=this.creatGrid9Component(t,l,r,a),_=new Object;return d.name=s,d.x=_.x=e,d.y=_.y=h,d.width=_.width=o,d.height=_.height=n,d.baseRec=_,this._list.push(d),d},i.prototype.getHeight=function(){return this._height},i.prototype.setItemUiX=function(t,i){t.baseRec.x=i,this.setY(this._sy)},i.prototype.setY=function(t){this._sy=t;for(var i=t+this.baseY,s=0;s<this._list.length;s++)this._list[s].y=this._list[s].baseRec.y+i,this._list[s].x=this._list[s].baseRec.x+this.baseX},i.prototype.setX=function(t){this._sx=t;for(var i=t+this.baseX,s=0;s<this._list.length;s++)this._list[s].y=this._list[s].baseRec.y+this.baseY,this._list[s].x=this._list[s].baseRec.x+i}}();var s=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return __extends(i,t),i.prototype.interactiveEvent=function(i){t.prototype.interactiveEvent.call(this,i);return this.slist.interactiveEvent(i)},i}(t.UIRenderComponent),e=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return __extends(i,t),i.prototype.interactiveEvent=function(i){return t.prototype.interactiveEvent.call(this,i)},i}(t.UIRenderComponent),h=function(i){function s(){return i.call(this)||this}return __extends(s,i),s.prototype.setData=function(i,s,e,h){this.ctx=t.UIManager.getInstance().getContext2D(i,s,!1),this.width=i,this.height=s,this.textureRes=t.TextureManager.getInstance().getCanvasTexture(this.ctx),this.xNum=e,this.yNum=h,this.itemWidth=i/this.xNum,this.itemHeight=s/this.yNum,this.configData=new Array},s.prototype.addConfig=function(t,i,s){var e=new Object,h=i%this.xNum*this.itemWidth,o=float2int(i/this.xNum)*this.itemHeight;e.ox=h+s.x,e.oy=o+s.y,e.ow=s.width,e.oh=s.height,e.x=e.ox/this.width,e.y=e.oy/this.height,e.width=e.ow/this.width,e.height=e.oh/this.height,e.name=t,this.configData.push(e)},s}(t.UIAtlas);!function(i){function o(){var t=null!==i&&i.apply(this,arguments)||this;return t._minScrollX=0,t._mouseX=0,t}__extends(o,i),o.prototype.setData=function(i,o,n,r,a,_,l,d,c,f,p,u){void 0===u&&(u=0),this.width=n,this._height=r,this.p_itemWidth=a,this.p_itemHeight=_,this._showIndexList=new Array,this._dataAry=i,this._showItemNum=l,this._allItemNum=f*p,this._contentX=f,this._contentY=p,this._outSize=(f-this._showItemNum)*a,this._topSize=0,this._bottomSize=this._outSize,this._showDataIndex=0,this._sAtlas=new h,this._sAtlas.setData(d,c,f,p),this.bgMask=new t.UIMask,this.bgMask.x=0,this.bgMask.y=0,this.bgMask.width=n,this.bgMask.height=r,this.bgMask.level=this._maskLevel,this.addMask(this.bgMask),this._bgRender=new s,this._bgRender.uiAtlas=this._sAtlas,this._bgRender.slist=this,this.addRender(this._bgRender),this._baseRender=new e,this._baseRender.uiAtlas=this._sAtlas,this.addRender(this._baseRender),this._bgRender.mask=this.bgMask,this._baseRender.mask=this.bgMask;var m;if(0!=u){m=new Array;for(y=0;y<u;y++){var g=new e;g.uiAtlas=this._sAtlas,this.addRender(g),g.mask=this.bgMask,m.push(g)}}this._itemList=new Array;for(var y=0;y<this._allItemNum;y++){var L=new o;L.baseX=float2int(y/p)*a,L.baseY=y%p*_,L.uiAtlas=this._sAtlas,L.index=y,L.parentTarget=this,L.create(this,this._bgRender,this._baseRender,m),L.render(this._dataAry[y]),this._itemList.push(L),this._showIndexList.push(y)}this._minScrollX=this.width-float2int(this._dataAry.length/this._contentY)*this.p_itemWidth,this.scrollX(0),this.initComplte()},o.prototype.changeMinScrollX=function(){this._minScrollX=this.width-float2int(this._dataAry.length/this._contentY)*this.p_itemWidth},o.prototype.refreshData=function(t){this._dataAry=t,this._showIndexList=new Array;for(var i=0;i<this._itemList.length;i++)this._itemList[i].render(this._dataAry[i]),this._itemList[i].baseX=float2int(i/this._contentY)*this.p_itemWidth,this._showIndexList.push(i);this._outSize=(this._contentX-this._showItemNum)*this.p_itemWidth,this._topSize=0,this._bottomSize=this._outSize,this._showDataIndex=0,this._minScrollX=this.width-float2int(this._dataAry.length/this._contentY)*this.p_itemWidth,this.scrollX(0),Math.ceil(t.length/this._contentY)<=this._showItemNum?this.scrollLock=!0:this.scrollLock=!1},o.prototype.interactiveEvent=function(i){return i.type==t.InteractiveEvent.Down&&(!!this.bgMask.testPoint(i.x,i.y)&&(this._mouseX=i.x,this.scrollLock||(t.Scene_data.uiStage.addEventListener(t.InteractiveEvent.Move,this.onMove,this),t.Scene_data.uiStage.addEventListener(t.InteractiveEvent.Up,this.onUp,this)),!0))},o.prototype.onMove=function(t){var i=t.x-this._mouseX;this._mouseX=t.x,i<0&&this.scrollLock||this.scrollX(i)},o.prototype.onUp=function(i){t.Scene_data.uiStage.removeEventListener(t.InteractiveEvent.Move,this.onMove,this),t.Scene_data.uiStage.removeEventListener(t.InteractiveEvent.Up,this.onUp,this)},o.prototype.scrollX=function(t){if(this._topSize-=t,this._bottomSize+=t,this._topSize<=0)if(this._bottomflag=!0,0==this._showDataIndex)this._topSize=0,this._bottomSize=this._outSize,this.p_scrollX=0,this._topflag=!1;else{for(var i=this._showIndexList[0],s=this._itemList[i].baseX-this.p_itemWidth,e=0;e<this._contentY;e++){n=this._showIndexList.pop();this._showIndexList.unshift(n),this._itemList[n].baseX=s,this._itemList[n].render(this._dataAry[this._showDataIndex-1]),this._itemList[n].selected=this.getCurrentSelectIndex()==this._showDataIndex-1,this._showDataIndex--}this._bottomSize-=this.p_itemWidth,this._topSize+=this.p_itemWidth,this.p_scrollX+=t,this._topflag=!0}else if(this._bottomSize<=0)if(this._topflag=!0,this._showDataIndex+this._allItemNum>=this._dataAry.length)this._bottomSize=0,this._topSize=this._outSize,this.p_scrollX=-(Math.ceil(this._dataAry.length/this._contentY)-this._showItemNum)*this.p_itemWidth,this._bottomflag=!1;else{this._bottomflag=!0;for(var h=this._showIndexList[this._showIndexList.length-1],o=this._itemList[h].baseX+this.p_itemWidth,e=0;e<this._contentY;e++){var n=this._showIndexList.shift();this._showIndexList.push(n),this._itemList[n].baseX=o,this._itemList[n].render(this._dataAry[this._showDataIndex+this._allItemNum]),this._itemList[n].selected=this.getCurrentSelectIndex()==this._showDataIndex+this._allItemNum,this._showDataIndex++}this._bottomSize+=this.p_itemWidth,this._topSize-=this.p_itemWidth,this.p_scrollX+=t}else this._showItemNum>=this._dataAry.length?(this._topflag=!1,this._bottomflag=!1,this.p_scrollX=0):(this._topflag=!0,this._bottomflag=!0,this.p_scrollX+=t);this.p_scrollX<=this._minScrollX&&this._minScrollX<0&&(this.p_scrollX=this._minScrollX,this._topSize+=t,this._bottomSize-=t,this._topflag=!0,this._bottomflag=!1),this.refreshResultPos(),this.backFun&&this.backFun(this._topflag,this._bottomflag,t)},o.prototype.scrollIdx=function(t){var i=-this.p_itemWidth*t-this.p_scrollX,s=Math.ceil(Math.abs(i)/this.p_itemWidth);i/=s;for(var e=0;e<s;e++)this.scrollX(i)},o.prototype.refreshResultPos=function(){for(t=0;t<this._itemList.length;t++)this._itemList[t].setX(this.p_scrollX);if(this.effList)for(var t=0;t<this.effList.length;t++)this.effList[t].x=this.effList[t].baseRec.x+this.p_scrollX}}(function(i){function s(){var s=null!==i&&i.apply(this,arguments)||this;return s._effRender=new t.FrameUIRender,s}return __extends(s,i),s.prototype.setEffectUrl=function(t,i,s,e){var h=this;void 0===e&&(e=1),this.effList&&this.effList.length>0?this.effectComplte():this._effRender.setImg(getEffectUIUrl(t),i,s,function(t){1==e?(h.effList=new Array,h.effList.push(t)):h.effList=t,h.effectComplte()},e)},s.prototype.initComplte=function(){this.addRender(this._effRender),this._effRender.mask=this.bgMask},s.prototype.effectComplte=function(){},s.prototype.refreshResultPos=function(){if(i.prototype.refreshResultPos.call(this),this.effList)for(var t=0;t<this.effList.length;t++)this.effList[t].y=this.effList[t].baseRec.y+this.p_scrollY,this.effList[t].x=this.effList[t].baseRec.x+this.p_scrollX},s.prototype.playEffect=function(t,i,s,e,h,o){void 0===o&&(o=3),this.effList&&this.effList.length>0&&(this.effList[t].x=i,this.effList[t].baseRec.y=s,this.effList[t].baseRec.x=i,this.effList[t].y=s+this.p_scrollY,this.effList[t].width=this.effList[t].baseRec.width*e,this.effList[t].height=this.effList[t].baseRec.height*h,this.effList[t].speed=o,this.effList[t].playOne(this))},s.prototype.effplay=function(t){t.parent||(this.addChild(t),t.play())},s.prototype.showEffect=function(t,i,s,e,h,o){void 0===o&&(o=3),this.effList&&this.effList.length>0&&(this.effList[t].x=i,this.effList[t].baseRec.y=s,this.effList[t].baseRec.x=i,this.effList[t].y=s+this.p_scrollY,this.effList[t].width=this.effList[t].baseRec.width*e,this.effList[t].height=this.effList[t].baseRec.height*h,this.effList[t].speed=o,this.effplay(this.effList[t]))},s.prototype.hideEffect=function(t){if(void 0===t&&(t=-1),this.effList&&this.effList.length>0)if(-1==t)for(var i=0;i<this.effList.length;i++)this.effList[i].parent&&this.effList[i].parent.removeChild(this.effList[i]);else t<this.effList.length&&t>=0&&this.effList[t].parent&&this.effList[t].parent.removeChild(this.effList[t])},s.prototype.dispose=function(){i.prototype.dispose.call(this),this._effRender.dispose()},s}(i))}(Pan3d||(Pan3d={}));